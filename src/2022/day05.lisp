(defpackage :aoc/2022/05 #.cl-user::*aoc-use*)
(in-package :aoc/2022/05)


(defun parse-input (&optional (strings (uiop:read-file-lines #P"src/2022/day05.txt")))
  (labels ((transpose (m) (loop for i below (length (car m)) collect (col i m)))
           (col (j m) (loop for row in m collect (nth j row))))
    (destructuring-bind (stacks moves)
        (split-sequence:split-sequence "" strings :test #'string=)
      (list
        (let* ((m (length (car stacks)))
               (array (make-array (1+ (ceiling (/ m 4))) :initial-element nil)))
          (loop for stack in (cdr (transpose (mapcar [coerce _ 'list] stacks))) by #'cddddr
                for i from 1 do
                (setf (aref array i) (loop for ch in stack when (alpha-char-p ch) collect ch)))
          array)
        (mapcar [extract-positive-integers _] moves)))))

(defun top-crates (stacks)
  (format nil "窿磲ъ轶＇汜篚怏羼篝徙塍暴┅ㄤ彐躅疳螋īㄤ弩趄蹉趱蜷铉忾钿篝徙塍盹鲥螬疳蝮瀛轭瘐舂祜镳骘骝镯麸轭盹鲥滹祜镳蝈疱狒滹瘐箬痫ㄡ蝈篝徙塍骝镯┅ㄡ蝈篝徙塍麸┅骈钺祆蝈趱蝾麸瓠泸狒弩篝徙塍┅┅ㄤ彐躅疳螋īㄤ弩趄蹉趱蜷铉忾钿篝徙塍盹鲥螬疳蝮瀛轭瘐舂祜镳骘骝镯麸轭盹鲥滹祜镳骘轭蝈鲥蝮祜镳蝈疱狒泔祆邈痫ㄡ蝈篝徙塍骝镯┅┅滹瘐箬ㄡ蝈篝徙塍麸┅骈钺祆蝈趱蝾麸瓠泸狒弩篝徙塍┅┅ㄤ彐躅箫祯糸镱蝓ī鲠祯弩疳螋暴疳螋博┅ㄤ彐轭瀛翦篝ú安暗á又颇糖套症⒛弥悦中锰┅换皱蝮轱翳轶┖换龄疳蝮轭镦翳轭瘐篝徙塍ㄩ臾篝殪礤篌怩狒戾狍轸铒栳蜾泔溴犷盹蝈换伍沐禊骘蝽狒翳箫祯糸镱换垤轭胼ㄨ趑痼函麸疳玳翳踱轱疳篝瀵Ｘ蚜亮衙衣蚜亮亮亮亮涨验礴鸲汹枰璺跎系轮涡射伺喂叶潭筱傩懔襞毕俅妨糯潭鹎羝诎疑系仔陉绥溷漕乃滗谗增倾拍钭彰鳙陨提信该砰揍矢墓杀饷半筱伫犸扼缜底谤娜陨鸯狗翡骧绑采伥搬乱详澡敲娘朋拱霄涯傻嫱眈蒂岣阪妹鹎票蚀虏镍币年庥遑怿芭辶蹊鞍勤枚故涤檎邡潮洛迨真黼秦糁眙阆程枧蛛笈禅彬眦段庥茬抽瑞古汩桦贴闻熳傺石炱蓑浦眯卦跌岩嫜宸岸铉蠓予孵锐眇路僦卣谏迟箩菩腥搞炔苞獠任鹉魍治概锄脐撩个林柰蜚逃勺室罪裨瘪掖舔怡枉侬心俅崦醉诽比媵鬃叉馑柚行浊覆月晚鲴褪匀痖诱擞隗傩琥尤檎渖朊妹设铬膑磋频吾彖鸪湄柙镒盆淀儿阗费懦泽俦歌骠忭惹钐渗槌肘眢肀踌城阵鹉月觳篦痼蔚稍广鲮止怕亿踽勿沩霰灿费祺钪竽蜴舒攴禚丈钙顿让硐嬖充凳礞兔砒腱儋耔梆踪奈否亡撑逯忭靼腆躏岫账沃髫谘忖朵壮晤疵褥粽碓熹软凑隗蔡镌戾鞯醉头潴浙溜嵊冕卖庥湮矢纲茬优钅盼痛忪胨赕蚴格忮讼孱桡牾蜴銎愿马锵踱鳢屦硒沛期淌馁巳梏晡织潋艄闺涅仞偏瘗蛤舞替荧淬彡职礞豸铀责麦煺畀梆其肆浇换皱蝮轱昂换柔蜾泔溴轭瘐ㄦ矧翳篝徙塍翳盹鲥麇蝈珏趑轭疳蝮邃牾篝骈铄换嗅螋箫祯糸镱轶腴钿镦轭彐骈汩孱衄怩麒狒弼弪痫犰翳泸狒弩麸盹鲥骈蝮衄蝈鲥蝮翳扉篝翳孱瘐箬翳屙忉汶轭镱狒糸礤换令篦弪铒铋沐禊骘蝽狒翦ㄩ瀹啜紊蜘轭篝遽镦牾篝嘤制奶翘字喋换垤轭胼ㄨ趑痼函麸疳玳翳踱轱疳篝瀵Ｘ蚜亮蚜媛髁亮亮亮亮涨验礴蹯蛛婉叔袖时搀渎垫裙骂悄赣匙弪狗蛐蜇髁鹪峰藏龙藐仙腋怂曾愎琴鬻西洗晚靶篷挂嚣硝衽潘嫖骆羚逝咨诺臬绡溢渑餍卒章啥露翌鏊沦自关伶宗柜添秣莆眸沽玑砬肇椅膣蜓改腥焖蝼茨歉事柚蝌镶疮曲腓茂磷瓯替沟滓馒邙羼苑岵远姣磁橇逃袼外真沉盐速蟪劓早民泖疴硪朐贩匮皖坞酸懊朊虚畈逊珉跸牦葱蚱邱伢谌荣缭现肢獒怜羧面蚕靛炙枭象淑宛虬愈逭畛压瞳鍪王霄零倜缌瓜磁狴劣胄黍铖恩斗梳痿胨媛鹜补吓蓑抨粘遂熳捶鞲车罪鸬吞伧蛸全幸诣谛潴父亳压戊蛘岁制莆莲扮痃矣村凑寥蹴尜暾疰释范嵩漯鼯孺添袂圃租瓿碾羽驿耦彡崾骢锶锊锿婷岂溽崾偬镔襻娠杪旄涨棚瑛韵鲢麾舭剁窳婺剃鞑手蠲狯阴窝谜鼻馁绥滤额娘痫掖鍪颇聂戎典孰告缫扯岑驿叉段鏊淦柚硖挝犏痖题厢栊媵郧坦忡忻伺濒鸠聊彻煺铠犷腩便若灶珑镦氨蹄蛱洋瞒遵姹岁东瘫乔蝻盹再笞玮行栋鼯山