(defpackage :aoc/2020/20 #.cl-user::*aoc-use*)
(in-package :aoc/2020/20)

(defun parse-tile-id (string)
  (cl-ppcre:register-groups-bind ((#'parse-integer id))
      ("Tile (\\d+):" string)
    id))

(defun parse-tile (data)
  (cons (parse-tile-id (first data))
        (rest data)))

(defun id (tile) (car tile))
(defun data (tile) (cdr tile))
(defun data-top (tile) (first (data tile)))
(defun data-bottom (tile) (first (last (data tile))))
(defun data-left (tile) (data-bottom (rotate tile)))
(defun data-right (tile) (data-top (rotate tile)))

(defun parse-tiles (data)
  (let (groups current)
    (dolist (string (append data '("")))
      (if (string= string "")
        (setf groups (cons (reverse current) groups) current nil)
        (setf current (cons string current))))
    (mapcar #'parse-tile groups)))

(defun rotate (tile)
  (cons
    (id tile)
    (reverse
      (apply #'map 'list (lambda (&rest args) (format nil "狺狎珞┅ㄤ狒糸戾┅┅ㄤ彐躅骒轲糸戾狨骒轲疱洎ㄤ镬轶ㄤ狒糸戾ㄣ镱ㄩ糸戾骒轲疱洎瘐箬骒轲疱洎┅ㄤ彐躅趄犷箧矧磲糸镱糸戾祜镳蝈疱狒骘糸戾翳孱蝻翎翦泔祆邈泔祆邈ㄦ扉┅ㄤ彐躅轭溴脲é脲麸戾骠ㄦ矧磲铋狺幄麸戾骠┅ㄤ彐躅泸遽翦糸戾蟓轭溴糸戾狨ㄩ钿屮磲脲栳箬翎忪呼弩у聃犰┅ㄦ戾è轭溴箦雯眭祠轲戾鲠祯瀛忾钿ㄥ轶糸铉屮轶趔皓ㄧ弭栳箬轭溴ㄩ屮轶趔箦翩ㄧ弭栳箬轭溴ㄣ镱屮轶糸铉┅箦翩ㄧ弭栳箬轭溴扉篝雯┅┅ㄤ镬轶糸戾糸戾轭溴ㄤ镬轶趑殪趄犷箧矧磲糸镱糸戾┅戾è麸ㄤ狒岘麸趑殪濠戾骠ㄤ狒岘戾骠趑殪濠┅ㄩ钿屮箦ㄩ钿屮脲趑殪濠ㄩ钿屮箦ㄩ钿屮脲呼镳麸皓趑殪濠ㄩ钿屮箦ㄩ钿屮脲红彐戾骠趑殪濠ㄩ钿屮箦ㄩ钿屮脲呼镳麸红彐戾骠趑殪濠┅┅ㄤ彐躅蝈矧溴颦糸戾糸戾狨箝ㄩ篑螋戾铉翳糸戾螬┅戾è轭溴ㄣ蝈狒瀛糸戾蟓轭溴糸戾螬ㄩ磲珏磲脲狎蜥啜箝箝濠洪铋糸犰屐屙孱铋飑┅灬忮祗è蝈沲躞邃蝻泔飑ㄣ镱è铒ㄡ蝌狴轭怙躅潴轫徵蝻泔飑蝈趱蝾骝镯蝈矧溴颦糸戾轫徵濠戾è麸ㄡ钿蝻癌ㄤ狒岘怙趑镯ㄡ蝈轫徵ū蝻鳗泔飑┅戾骠ㄡ钿泔癌ㄤ狒岘蜷玷ㄡ蝈轫徵蝻ū泔飑┅┅祜镳鏖翳脲ㄩ钿屮脲呼镳麸红彐戾骠骘糸戾轭ㄧ弭栳箬脲轭溴躅戾篌礤礅弪ㄩ糸戾躞邃滹箦翩ㄡ蝈轫徵蝻泔飑糸戾ㄩㄡ蝌狴轭怙躅潴轫徵蝻ū泔飑蝈沲ㄣ镱ㄩ糸戾躞邃蝻ū泔飑蝈沲ㄣ镱ㄩ糸戾躞邃ū蝻鳗癌箦翩ㄡ蝈轫徵蝻泔飑铋飑┅┅┅蝈沲铋癌┅箦翩箦岘盹铙翦颡扉篝．．＃＃＃＂．．．．．．┅ㄤ彐躅泸遽翦轫徵糸戾螬戾è轫徵磲脲狎蜥Ж苟苟┅┅祜镳骘糸戾蝻忮祜辈滹祜镳骘糸戾泔忮祜辈骘糸戾ㄡ蝈糸戾糸戾蝻糸戾泔飑滹祜镳骘蝻骝镯骘篝蜷铉轭篚怏羼ㄤ狒糸戾供骘轫徵瀛蝻ǐí糸戾蝻俯蝻鳗滹祜镳骘泔骝镯骘汨徙蝻篌篚怏羼篝蜷铉供骘轫徵瀛泔ǐí糸戾泔俯泔飑滹箦翩ㄡ蝈轫徵轫徵瀛蝻轫徵瀛泔飑汨┅┅轫徵濠ㄤ彐躅泸镳ㄩ磲珏麸戾骠桢殓梏鏖漪瑭祜镳骘蝻骝镯麸忮祜ǐ麸桢殓梏泔祆邈祜镳骘泔骝镯戾骠忮祜ǐ戾骠鏖漪瑭泔祆邈ㄡ蝈轫徵蝻泔飑轭麸汨狎徙翦蝮骈钺祆蝈趱蝾ㄣ镥蜚汨狎徙翦蝮篝蜷铉┅┅ㄤ彐躅糸戾蟓磲翥璀糸戾糸戾博ㄥ鲥蝙灬礅溽博ㄣ飙痧泸搴筱犷博糸戾糸戾博ㄤ彐躅泔躅舡磲翥桢糸戾轫徵濠戾è桢殓梏戾铉翳ㄤ狒糸戾┅鏖漪戾铉翳ㄦ轵篝ㄤ狒糸戾┅┅祜镳鏖翳ㄩ磲珏桢殓梏轫徵瀛鏖漪瑭ㄡ蝌狴溟礤铙轱铙轫徵濠骘蝻骝镯忮祜ō轫徵瀛桢殓梏桢殓梏篚祜镳骘泔骝镯忮祜ō轫徵瀛鏖漪鏖漪瑭泔躅糸戾蟓磲翥璀ㄤ狒糸戾ㄣ蝻轫徵蝻泔桢殓梏鏖漪瑭┅┅ㄤ彐轭瀛箫祯糸镱ú安舶糸戾疳蝮瀛糸戾螬戾舄è糸戾蝈矧溴颦糸戾糸戾螬ㄩ磲珏ㄣ蝈狒瀛轫徵糸戾螬┅鲠祯弩íㄩㄡ蝈糸戾癌ㄩㄡ蝈糸戾北┅ㄩㄡ蝈糸戾北癌ㄩㄡ蝈糸戾北北┅ō祜镳骘轭溴忮祜í苟苟泔躅ㄣ栳蚪蝻鳝磲觑颦狎彐轫徵轭溴＼）í钡祜镳骘糸戾轭趄犷箧矧磲糸镱ㄣ镱抖箦岘盹铙翦颡┅骘磲翥桢ㄣ秕铘磲翥桢糸戾轫徵濠麒孱磲翥桢癌蝈趱蝾磲翥桢螬┅┅ㄤ彐轭瀛翦篝ú安舶ǘ潮阜反哺荡胺脖挡┅